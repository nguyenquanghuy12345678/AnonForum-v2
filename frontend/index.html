<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AnonForum - Di·ªÖn ƒë√†n th·∫£o lu·∫≠n ·∫©n danh ho√†n to√†n an to√†n">
    <meta name="keywords" content="anonymous, forum, privacy, discussion, secure">
    <meta name="robots" content="noindex, nofollow">
    <title>AnonForum - Di·ªÖn ƒë√†n ·∫©n danh</title>
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; img-src 'self' data: https:; connect-src 'self'; font-src 'self' https://cdnjs.cloudflare.com;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="css/style.css" as="style">
    <link rel="preload" href="js/main.js" as="script">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/icons/favicon.ico">
    
    <!-- No referrer for privacy -->
    <meta name="referrer" content="no-referrer">
</head>
<body>
    <!-- Loading screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <p>ƒêang t·∫£i di·ªÖn ƒë√†n ·∫©n danh...</p>
    </div>

    <!-- Main container -->
    <div class="container" id="mainContainer" style="display: none;">
        <!-- Privacy notice banner -->
        <div class="privacy-banner" id="privacyBanner">
            <div class="privacy-content">
                <span class="privacy-icon">üõ°Ô∏è</span>
                <div class="privacy-text">
                    <strong>Ho√†n to√†n ·∫©n danh:</strong> Ch√∫ng t√¥i kh√¥ng l∆∞u IP, kh√¥ng theo d√µi, d·ªØ li·ªáu t·ª± x√≥a sau 7 ng√†y
                </div>
                <button class="privacy-close" onclick="closePrivacyBanner()">‚úï</button>
            </div>
        </div>

        <!-- Online counter -->
        <div class="online-counter">
            <span class="online-dot"></span>
            <span id="onlineCount">0</span> ng∆∞·ªùi online
        </div>

        <!-- Header -->
        <header class="header">
            <div class="logo-container">
                <h1 class="logo">üïµÔ∏è AnonForum</h1>
                <p class="subtitle">N∆°i th·∫£o lu·∫≠n ·∫©n danh an to√†n nh·∫•t</p>
            </div>
            
            <div class="stats-container">
                <div class="stat-item">
                    <span class="stat-number" id="totalPosts">0</span>
                    <span class="stat-label">B√†i vi·∫øt</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="totalComments">0</span>
                    <span class="stat-label">B√¨nh lu·∫≠n</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="postsToday">0</span>
                    <span class="stat-label">H√¥m nay</span>
                </div>
            </div>
        </header>

        <!-- Create post section -->
        <section class="create-post-section">
            <button class="create-post-toggle" onclick="toggleCreatePost()">
                <span class="toggle-icon">‚úçÔ∏è</span>
                <span class="toggle-text">T·∫°o b√†i vi·∫øt ·∫©n danh</span>
                <span class="toggle-arrow">‚ñº</span>
            </button>
            
            <div class="create-post-form" id="createPostForm" style="display: none;">
                <form id="postForm" novalidate>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="postTitle">Ti√™u ƒë·ªÅ b√†i vi·∫øt</label>
                            <input 
                                type="text" 
                                id="postTitle" 
                                maxlength="200" 
                                placeholder="Nh·∫≠p ti√™u ƒë·ªÅ..." 
                                required
                                autocomplete="off"
                            >
                            <div class="char-counter">
                                <span id="titleCounter">0</span>/200
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="postCategory">Ch·ªß ƒë·ªÅ</label>
                            <select id="postCategory" required>
                                <option value="">Ch·ªçn ch·ªß ƒë·ªÅ</option>
                                <option value="general">üåê T·ªïng h·ª£p</option>
                                <option value="tech">üíª C√¥ng ngh·ªá</option>
                                <option value="crypto">‚Çø Cryptocurrency</option>
                                <option value="society">üë• X√£ h·ªôi</option>
                                <option value="random">üé≤ Random</option>
                                <option value="confession">üí≠ T√¢m s·ª±</option>
                                <option value="question">‚ùì H·ªèi ƒë√°p</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="postContent">N·ªôi dung</label>
                        <textarea 
                            id="postContent" 
                            maxlength="5000" 
                            placeholder="Chia s·∫ª suy nghƒ© c·ªßa b·∫°n m·ªôt c√°ch ·∫©n danh..." 
                            required
                            rows="6"
                        ></textarea>
                        <div class="char-counter">
                            <span id="contentCounter">0</span>/5000
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="postTags">Tags (t√πy ch·ªçn)</label>
                        <input 
                            type="text" 
                            id="postTags" 
                            placeholder="V√≠ d·ª•: cu·ªôc s·ªëng, c√¥ng ngh·ªá, t√¢m s·ª± (c√°ch nhau b·∫±ng d·∫•u ph·∫©y)"
                            autocomplete="off"
                        >
                        <small class="form-hint">T·ªëi ƒëa 5 tags, m·ªói tag kh√¥ng qu√° 50 k√Ω t·ª±</small>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="clearForm()">
                            X√≥a form
                        </button>
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <span class="btn-icon">üöÄ</span>
                            <span class="btn-text">ƒêƒÉng b√†i ·∫©n danh</span>
                            <span class="btn-loading" style="display: none;">‚è≥</span>
                        </button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Filter bar -->
        <section class="filter-bar">
            <div class="filter-tabs">
                <button class="filter-tab active" data-category="all" onclick="filterPosts('all')">
                    T·∫•t c·∫£
                </button>
                <button class="filter-tab" data-category="general" onclick="filterPosts('general')">
                    üåê T·ªïng h·ª£p
                </button>
                <button class="filter-tab" data-category="tech" onclick="filterPosts('tech')">
                    üíª Tech
                </button>
                <button class="filter-tab" data-category="crypto" onclick="filterPosts('crypto')">
                    ‚Çø Crypto
                </button>
                <button class="filter-tab" data-category="society" onclick="filterPosts('society')">
                    üë• X√£ h·ªôi
                </button>
                <button class="filter-tab" data-category="confession" onclick="filterPosts('confession')">
                    üí≠ T√¢m s·ª±
                </button>
                <button class="filter-tab" data-category="question" onclick="filterPosts('question')">
                    ‚ùì H·ªèi ƒë√°p
                </button>
            </div>
            
            <div class="filter-controls">
                <select id="sortBy" onchange="sortPosts()">
                    <option value="createdAt">M·ªõi nh·∫•t</option>
                    <option value="likes">Nhi·ªÅu like</option>
                    <option value="commentCount">Nhi·ªÅu b√¨nh lu·∫≠n</option>
                </select>
                <button class="refresh-btn" onclick="refreshPosts()" title="L√†m m·ªõi">
                    üîÑ
                </button>
            </div>
        </section>

        <!-- Posts container -->
        <main class="posts-section">
            <div class="posts-container" id="postsContainer">
                <!-- Posts will be loaded here -->
                <div class="loading-posts">
                    <div class="loading-spinner small"></div>
                    <p>ƒêang t·∫£i b√†i vi·∫øt...</p>
                </div>
            </div>
            
            <!-- Pagination -->
            <div class="pagination" id="pagination" style="display: none;">
                <button class="pagination-btn" id="prevBtn" onclick="changePage(-1)">
                    ‚Üê Trang tr∆∞·ªõc
                </button>
                <span class="pagination-info" id="pageInfo">
                    Trang 1 / 1
                </span>
                <button class="pagination-btn" id="nextBtn" onclick="changePage(1)">
                    Trang sau ‚Üí
                </button>
            </div>
        </main>

        <!-- Modal for comments -->
        <div class="modal" id="commentsModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üí¨ B√¨nh lu·∫≠n</h3>
                    <button class="modal-close" onclick="closeCommentsModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="post-preview" id="modalPostPreview"></div>
                    <div class="comments-list" id="commentsList"></div>
                    <form class="comment-form" id="commentForm">
                        <textarea 
                            id="commentContent" 
                            placeholder="Vi·∫øt b√¨nh lu·∫≠n ·∫©n danh..." 
                            maxlength="2000"
                            rows="3"
                            required
                        ></textarea>
                        <div class="comment-form-actions">
                            <div class="char-counter">
                                <span id="commentCounter">0</span>/2000
                            </div>
                            <button type="submit" class="btn btn-primary">
                                üí¨ G·ª≠i b√¨nh lu·∫≠n
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Notification container -->
        <div class="notification-container" id="notificationContainer"></div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p>üõ°Ô∏è AnonForum - B·∫£o v·ªá quy·ªÅn ri√™ng t∆∞ tuy·ªát ƒë·ªëi</p>
            <div class="footer-links">
                <button onclick="showAbout()">Gi·ªõi thi·ªáu</button>
                <button onclick="showPrivacyPolicy()">Ch√≠nh s√°ch</button>
                <button onclick="showSecurityInfo()">B·∫£o m·∫≠t</button>
            </div>
        </div>
    </footer>

    <!-- About Modal -->
    <div class="modal" id="aboutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üïµÔ∏è V·ªÅ AnonForum</h3>
                <button class="modal-close" onclick="closeModal('aboutModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="about-content">
                    <h4>üõ°Ô∏è Cam k·∫øt b·∫£o m·∫≠t</h4>
                    <ul>
                        <li>‚úÖ Kh√¥ng l∆∞u ƒë·ªãa ch·ªâ IP</li>
                        <li>‚úÖ Kh√¥ng y√™u c·∫ßu ƒëƒÉng k√Ω</li>
                        <li>‚úÖ D·ªØ li·ªáu t·ª± x√≥a sau 7 ng√†y</li>
                        <li>‚úÖ M√£ h√≥a n·ªôi dung</li>
                        <li>‚úÖ Kh√¥ng theo d√µi ng∆∞·ªùi d√πng</li>
                    </ul>
                    
                    <h4>üéØ M·ª•c ƒë√≠ch</h4>
                    <p>T·∫°o kh√¥ng gian th·∫£o lu·∫≠n an to√†n, n∆°i m·ªçi ng∆∞·ªùi c√≥ th·ªÉ chia s·∫ª suy nghƒ© m·ªôt c√°ch ·∫©n danh m√† kh√¥ng lo b·ªã theo d√µi hay ph√°n x√©t.</p>
                    
                    <h4>‚öñÔ∏è Quy t·∫Øc c·ªông ƒë·ªìng</h4>
                    <ul>
                        <li>üö´ Kh√¥ng spam, qu·∫£ng c√°o</li>
                        <li>üö´ Kh√¥ng n·ªôi dung b·∫°o l·ª±c, ph√¢n bi·ªát</li>
                        <li>üö´ Kh√¥ng chia s·∫ª th√¥ng tin c√° nh√¢n</li>
                        <li>‚úÖ T√¥n tr·ªçng √Ω ki·∫øn kh√°c bi·ªát</li>
                        <li>‚úÖ Th·∫£o lu·∫≠n vƒÉn minh, x√¢y d·ª±ng</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Boundary -->
    <div class="error-boundary" id="errorBoundary" style="display: none;">
        <div class="error-content">
            <h3>‚ö†Ô∏è ƒê√£ x·∫£y ra l·ªói</h3>
            <p>Vui l√≤ng t·∫£i l·∫°i trang ho·∫∑c th·ª≠ l·∫°i sau.</p>
            <button onclick="location.reload()" class="btn btn-primary">
                üîÑ T·∫£i l·∫°i trang
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/main.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('SW registered: ', registration);
                    })
                    .catch(function(registrationError) {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>

    <!-- Error handling -->
    <script>
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
            showErrorBoundary();
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled promise rejection:', e.reason);
            showNotification('ƒê√£ x·∫£y ra l·ªói, vui l√≤ng th·ª≠ l·∫°i', 'error');
        });

        function showErrorBoundary() {
            document.getElementById('mainContainer').style.display = 'none';
            document.getElementById('errorBoundary').style.display = 'flex';
        }
    </script>
</body>
</html>